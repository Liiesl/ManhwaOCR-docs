{#
  Renders a nested, collapsible navigation list.
  - items: The array of navigation items to render.
  - page: The current page object from Eleventy.
#}
{% macro navList(items, page) %}
  <ul>
    {% for item in items %}
      {#
        Determine if the current link is a parent of the active page.
        This is true if the current page's URL starts with this item's URL
        (and it's not the homepage).
      #}
      {% set isActiveParent = (item.url != "/" and page.url.startsWith(item.url)) %}
      {# Determine if this is the exact current page #}
      {% set isCurrentPage = (item.url == page.url) %}

      <li>
        {# If this item has children, render it as a collapsible <details> element #}
        {% if item.children.length > 0 %}
          <details class="nav-collapsible" {% if isActiveParent %}open{% endif %}>
            <summary>
              <a href="{{ item.url }}" class="{{ 'active' if isCurrentPage }}">
                {{ item.title }}
              </a>
            </summary>
            {# Recursively call this macro to render the children inside the <details> #}
            {{ navList(item.children, page) }}
          </details>
        {# If it has no children, render it as a simple link #}
        {% else %}
          <a href="{{ item.url }}" class="{{ 'active' if isCurrentPage }}">
            {{ item.title }}
          </a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endmacro %}